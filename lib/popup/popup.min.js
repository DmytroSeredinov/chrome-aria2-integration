function bytesToSize(a,d){return 0<=a&&1024>a?a+" B":1024<=a&&1048576>a?(a/1024).toFixed(d)+" KB":1048576<=a&&1073741824>a?(a/1048576).toFixed(d)+" MB":1073741824<=a&&1099511627776>a?(a/1073741824).toFixed(d)+" GB":1099511627776<=a?(a/1099511627776).toFixed(d)+" TB":a+" B"}
Number.prototype.toHHMMSS=function(){var a=parseInt(this,10);if(isNaN(a)||null===a)time="-";else{var d=Math.floor(a/3600),e=Math.floor((a-3600*d)/60),a=a-3600*d-60*e;10>d&&(d="0"+d);10>e&&(e="0"+e);10>a&&(a="0"+a);time=d+"h"+e+"m"+a+"s";time=time.replace(/00[\w]{1}/g,"");isNaN(d)&&isNaN(e)&&isNaN(a)&&(time="\u221e")}return time};function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}
Object.defineProperty(Array.prototype,"prepend",{enumerable:!1,configurable:!1,writable:!1,value:function(a){""!=a&&this.unshift(a);return this}});chrome.storage.local.get(null,function(a){var d;a.rpcuser?(d=a.rpcpath.replace(/(\:\/\/)/g,"$1"+a.rpcuser+":"+a.rpctoken+"@"),window.rpct=""):(d=a.rpcpath,window.rpct=a.rpctoken?"token:"+a.rpctoken:"");$.jsonRPC.setup({endPoint:d,namespace:"aria2"})});
function aria2CMD(a,d){chrome.storage.local.get(null,function(e){$.jsonRPC.request(a,{params:[d].prepend(rpct)})})}var headInfotpl=document.getElementById("headInfo").innerHTML,taskInfotpl=document.getElementById("taskInfo").innerHTML;Mustache.parse(headInfotpl);Mustache.parse(taskInfotpl);
function writeUI(){chrome.storage.local.get(null,function(a){$.jsonRPC.request("getGlobalStat",{params:[rpct],success:function(a){a=a.result;var e={};e.globspeed=bytesToSize(a.downloadSpeed,2);e=Mustache.render(headInfotpl,a,e);document.getElementById("globalstat").innerHTML=e;e="status gid completedLength totalLength files connections dir downloadSpeed bittorrent uploadSpeed numSeeders".split(" ");$.jsonRPC.batchRequest([{method:"tellActive",params:[e].prepend(rpct)},{method:"tellWaiting",params:[0,
parseInt(a.numWaiting),e].prepend(rpct)},{method:"tellStopped",params:[0,parseInt(a.numStopped),e].prepend(rpct)}],{success:function(a){0!==a[0].result.length+a[1].result.length+a[2].result.length||$(document).find(".tasktitle").length?printTask(a):document.getElementById("tasklist").innerHTML="Empty task list"}})}})})}
function printTask(a){for(var d="",e=a.length,g=0;g<e;g++)for(var c=a[g].result,l=c.length,h,k,f={},b=0;b<l;b++)h=c[b].files,k=c[b].gid,f.displayName=c[b].bittorrent&&c[b].bittorrent.info&&c[b].bittorrent.info.name?c[b].bittorrent.info.name:h[0].path.split("/").pop(),c[b].bittorrent?(f.upspeedPrec=" (up:"+bytesToSize(c[b].uploadSpeed,2)+"/s)",f.numSeedersf="/"+c[b].numSeeders.toString()+" seeds"):(f.upspeedPrec="",f.numSeedersf=""),f.dlspeedPrec=bytesToSize(c[b].downloadSpeed,2),f.tlengthPrec=bytesToSize(c[b].totalLength,
2),f.clengthPrec=bytesToSize(c[b].completedLength,2),f.completeRatio=parseFloat(c[b].completedLength/c[b].totalLength*100,2).toFixed(2).toString(),f.eta=((c[b].totalLength-c[b].completedLength)/c[b].downloadSpeed).toHHMMSS(),f.statusUpper=capitaliseFirstLetter(c[b].status),document.getElementById("taskBar_"+k),isNaN(c[b].completedLength)||0==c[b].completedLength?f.p="0%":f.p=parseFloat(c[b].completedLength/c[b].totalLength*100,2).toFixed(2).toString()+"%",d+=Mustache.render(taskInfotpl,c[b],f);document.getElementById("tasklist").innerHTML=
d;$(document.getElementById("purgebtn")).click(function(){aria2CMD("purgeDownloadResult","")});$(document.getElementsByClassName("removebtn")).click(function(){var a=$(this).attr("class").split(" ")[0],b=$(this).attr("id").split("_").pop(),c;switch(a){case "active":case "waiting":case "paused":c="forceRemove";break;case "error":case "complete":case "removed":c="removeDownloadResult"}aria2CMD(c,b)});$(document.getElementsByClassName("progbar")).click(function(){var a=$(this).attr("class").split(" ")[0],
c=$(this).attr("id").split("_").pop(),b;switch(a){case "active":case "waiting":b="pause";break;case "error":case "complete":case "removed":b="removeDownloadResult";break;case "paused":b="unpause"}aria2CMD(b,c)})}writeUI();var uirefrsh=setInterval(writeUI,1E3);