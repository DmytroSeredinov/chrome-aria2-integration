function bytesToSize(a,d){return 0<=a&&1024>a?a+" B":1024<=a&&1048576>a?(a/1024).toFixed(d)+" KB":1048576<=a&&1073741824>a?(a/1048576).toFixed(d)+" MB":1073741824<=a&&1099511627776>a?(a/1073741824).toFixed(d)+" GB":1099511627776<=a?(a/1099511627776).toFixed(d)+" TB":a+" B"}
Number.prototype.toHHMMSS=function(){var a=parseInt(this,10);if(isNaN(a)||null===a)time="-";else{var d=Math.floor(a/3600),e=Math.floor((a-3600*d)/60),a=a-3600*d-60*e;10>d&&(d="0"+d);10>e&&(e="0"+e);10>a&&(a="0"+a);time=d+"h"+e+"m"+a+"s";time=time.replace(/00[\w]{1}/g,"");isNaN(d)&&isNaN(e)&&isNaN(a)&&(time="\u221e")}return time};function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}chrome.storage.local.get(null,function(a){$.jsonRPC.setup({endPoint:a.rpcpath,namespace:"aria2"})});
function aria2CMD(a,d){chrome.storage.local.get(null,function(e){$.jsonRPC.request(a,{params:["token:"+e.rpctoken,d]})})}
function writeUI(){chrome.storage.local.get(null,function(a){var d="token:"+a.rpctoken;$.jsonRPC.request("getGlobalStat",{params:[d],success:function(a){a=a.result;var b=$("#headInfo").html(),f={};Mustache.parse(b);f.globspeed=bytesToSize(a.downloadSpeed,2);b=Mustache.render(b,a,f);$("#globalstat").html(b);b="status gid completedLength totalLength files connections dir downloadSpeed".split(" ");$.jsonRPC.batchRequest([{method:"tellActive",params:[d,b]},{method:"tellWaiting",params:[d,0,parseInt(a.numWaiting),
b]},{method:"tellStopped",params:[d,0,parseInt(a.numStopped),b]}],{success:function(a){0!==a[0].result.length+a[1].result.length+a[2].result.length||$(document).find(".tasktitle").length?printTask(a):$("#activetpl").html("Empty task list")}})}})})}
function printTask(a){for(var d=["#activetpl","#waitingtpl","#stoppedtpl"],e=0;e<a.length;e++){var b=a[e].result,f=$("#taskInfo").html(),h="",k,g={};Mustache.parse(f);for(var c=0;c<b.length;c++)k=b[c].files,g.displayName=k[0].path.split("/").pop(),g.dlspeedPrec=bytesToSize(b[c].downloadSpeed,2),g.tlengthPrec=bytesToSize(b[c].totalLength,2),g.clengthPrec=bytesToSize(b[c].completedLength,2),g.completeRatio=parseFloat(b[c].completedLength/b[c].totalLength*100,2).toFixed(2).toString(),g.eta=((b[c].totalLength-
b[c].completedLength)/b[c].downloadSpeed).toHHMMSS(),g.statusUpper=capitaliseFirstLetter(b[c].status),h+=Mustache.render(f,b[c],g);$(d[e]).html(h);for(c=0;c<b.length;c++){switch(b[c].status){case "active":case "paused":case "waiting":barbg="#ACF";break;case "error":barbg="#EA6A6A";break;case "complete":barbg="#8AE62E";break;case "removed":barbg="#ECECEC"}f={bg:barbg,target:document.getElementById("taskBar_"+b[c].gid)};f=new Nanobar(f);isNaN(b[c].completedLength)||0==b[c].completedLength?f.go(0):f.go(b[c].completedLength/
b[c].totalLength*100)}}$("#WEBUI").ready(function(){$("#purgebtn").click(function(){aria2CMD("purgeDownloadResult","")});$("button[id*=removebtn]").click(function(){var a=$(this).attr("class"),b=$(this).attr("id").split("_").pop(),c;switch(a){case "active":case "waiting":case "paused":c="forceRemove";break;case "error":case "complete":case "removed":c="removeDownloadResult"}aria2CMD(c,b)});$("div[id*=taskBar]").click(function(){var a=$(this).attr("class"),b=$(this).attr("id").split("_").pop(),c;switch(a){case "active":case "waiting":c=
"pause";break;case "error":case "complete":case "removed":c="removeDownloadResult";break;case "paused":c="unpause"}aria2CMD(c,b)})})}writeUI();var uirefrsh=setInterval(writeUI,1E3);