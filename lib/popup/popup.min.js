function bytesToSize(a,b){return 0<=a&&1024>a?a+" B":1024<=a&&1048576>a?(a/1024).toFixed(b)+" KB":1048576<=a&&1073741824>a?(a/1048576).toFixed(b)+" MB":1073741824<=a&&1099511627776>a?(a/1073741824).toFixed(b)+" GB":1099511627776<=a?(a/1099511627776).toFixed(b)+" TB":a+" B"}
Number.prototype.toHHMMSS=function(){var a=parseInt(this,10);if(isNaN(a)||null===a)time="-";else{var b=Math.floor(a/3600),f=Math.floor((a-3600*b)/60),a=a-3600*b-60*f;10>b&&(b="0"+b);10>f&&(f="0"+f);10>a&&(a="0"+a);time=b+"h"+f+"m"+a+"s";time=time.replace(/00[\w]{1}/g,"");isNaN(b)&&isNaN(f)&&isNaN(a)&&(time="\u221e")}return time};function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}chrome.storage.local.get(null,function(a){$.jsonRPC.setup({endPoint:a.rpcpath,namespace:"aria2"})});
function aria2CMD(a,b){chrome.storage.local.get(null,function(f){$.jsonRPC.request(a,{params:["token:"+f.rpctoken,b]})})}var headInfotpl=document.getElementById("headInfo").innerHTML,taskInfotpl=document.getElementById("taskInfo").innerHTML;Mustache.parse(headInfotpl);Mustache.parse(taskInfotpl);
function writeUI(){chrome.storage.local.get(null,function(a){var b="token:"+a.rpctoken;$.jsonRPC.request("getGlobalStat",{params:[b],success:function(a){a=a.result;var e={};e.globspeed=bytesToSize(a.downloadSpeed,2);e=Mustache.render(headInfotpl,a,e);document.getElementById("globalstat").innerHTML=e;e="status gid completedLength totalLength files connections dir downloadSpeed".split(" ");$.jsonRPC.batchRequest([{method:"tellActive",params:[b,e]},{method:"tellWaiting",params:[b,0,parseInt(a.numWaiting),
e]},{method:"tellStopped",params:[b,0,parseInt(a.numStopped),e]}],{success:function(a){0!==a[0].result.length+a[1].result.length+a[2].result.length||$(document).find(".tasktitle").length?printTask(a):document.getElementById("tasklist").innerHTML="Empty task list"}})}})})}
function printTask(a){for(var b="",f=a.length,e=0;e<f;e++)for(var d=a[e].result,l=d.length,h,k,g={},c=0;c<l;c++)h=d[c].files,k=d[c].gid,g.displayName=h[0].path.split("/").pop(),g.dlspeedPrec=bytesToSize(d[c].downloadSpeed,2),g.tlengthPrec=bytesToSize(d[c].totalLength,2),g.clengthPrec=bytesToSize(d[c].completedLength,2),g.completeRatio=parseFloat(d[c].completedLength/d[c].totalLength*100,2).toFixed(2).toString(),g.eta=((d[c].totalLength-d[c].completedLength)/d[c].downloadSpeed).toHHMMSS(),g.statusUpper=
capitaliseFirstLetter(d[c].status),document.getElementById("taskBar_"+k),isNaN(d[c].completedLength)||0==d[c].completedLength?g.p="0%":g.p=parseFloat(d[c].completedLength/d[c].totalLength*100,2).toFixed(2).toString()+"%",b+=Mustache.render(taskInfotpl,d[c],g);document.getElementById("tasklist").innerHTML=b;$(document.getElementById("purgebtn")).click(function(){aria2CMD("purgeDownloadResult","")});$(document.getElementsByClassName("removebtn")).click(function(){var a=$(this).attr("class").split(" ")[0],
b=$(this).attr("id").split("_").pop(),c;switch(a){case "active":case "waiting":case "paused":c="forceRemove";break;case "error":case "complete":case "removed":c="removeDownloadResult"}aria2CMD(c,b)});$(document.getElementsByClassName("progbar")).click(function(){var a=$(this).attr("class").split(" ")[0],b=$(this).attr("id").split("_").pop(),c;switch(a){case "active":case "waiting":c="pause";break;case "error":case "complete":case "removed":c="removeDownloadResult";break;case "paused":c="unpause"}aria2CMD(c,
b)})}writeUI();var uirefrsh=setInterval(writeUI,1E3);